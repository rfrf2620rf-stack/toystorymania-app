/* ==============================
   トイ・ストーリー・マニア! CSS
   ============================== */

/* ---------- Color Tokens ---------- */
:root {
  --ts-red: #e63946;
  --ts-yellow: #ffd166;
  --ts-blue: #118ab2;
  --ts-green: #06d6a0;
  --ts-purple: #7b2d8e;
  --ts-orange: #f77f00;
  --ts-dark: #1a1a2e;
  --ts-light: #fff8e7;
  --ts-white: #ffffff;
  --font-display: "Fredoka One", "Noto Sans JP", sans-serif;
  --font-body: "Noto Sans JP", sans-serif;
}

/* ---------- Reset & Base ---------- */
*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
html,
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: var(--font-body);
  background: var(--ts-dark);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
}

/* ---------- Screen Manager ---------- */
.screen {
  position: fixed;
  inset: 0;
  display: none;
  z-index: 1;
}
.screen.active {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: screenFadeIn 0.5s ease-out;
}
@keyframes screenFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ==============================
   TITLE SCREEN
   ============================== */
.title-bg {
  width: 100%;
  height: 100%;
  background: linear-gradient(
    180deg,
    #1a1a5e 0%,
    #2d1b69 30%,
    #4a1942 60%,
    #e63946 100%
  );
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
.title-bg::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      circle at 20% 30%,
      rgba(255, 209, 102, 0.15) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 60%,
      rgba(17, 138, 178, 0.15) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 50% 80%,
      rgba(230, 57, 70, 0.2) 0%,
      transparent 40%
    );
  pointer-events: none;
}

/* Stars */
.stars-container {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.star {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--ts-yellow);
  border-radius: 50%;
  animation: twinkle 2s ease-in-out infinite alternate;
}
@keyframes twinkle {
  0% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  100% {
    opacity: 1;
    transform: scale(1.2);
  }
}

/* Title Content */
.title-content {
  position: relative;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  text-align: center;
  padding: 20px;
}
.title-logo {
  animation: titleBounce 3s ease-in-out infinite;
}
@keyframes titleBounce {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}
.title-text {
  display: flex;
  flex-direction: column;
  line-height: 1.1;
  font-family: var(--font-display);
  text-shadow:
    3px 3px 0 rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 209, 102, 0.4);
}
.title-toy {
  font-size: clamp(48px, 12vw, 80px);
  color: var(--ts-yellow);
  letter-spacing: 8px;
}
.title-story {
  font-size: clamp(56px, 14vw, 96px);
  color: var(--ts-white);
  letter-spacing: 12px;
  margin-top: -8px;
}
.title-mania {
  font-size: clamp(40px, 10vw, 72px);
  color: var(--ts-red);
  letter-spacing: 4px;
}
.title-subtitle {
  font-family: var(--font-display);
  font-size: clamp(16px, 4vw, 24px);
  color: var(--ts-yellow);
  letter-spacing: 4px;
  margin-top: 8px;
  opacity: 0.9;
}

/* Title Characters */
.title-characters {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin-top: 10px;
}
.title-woody,
.title-jessie {
  height: clamp(100px, 25vw, 180px);
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
}
.title-woody {
  animation: charSwayL 4s ease-in-out infinite;
}
.title-jessie {
  animation: charSwayR 4s ease-in-out infinite;
}
@keyframes charSwayL {
  0%,
  100% {
    transform: rotate(-3deg);
  }
  50% {
    transform: rotate(3deg);
  }
}
@keyframes charSwayR {
  0%,
  100% {
    transform: rotate(3deg);
  }
  50% {
    transform: rotate(-3deg);
  }
}

/* Speech Bubble */
.title-speech {
  background: var(--ts-white);
  color: var(--ts-dark);
  border-radius: 20px;
  padding: 12px 24px;
  position: relative;
  font-weight: 700;
  font-size: clamp(14px, 3.5vw, 20px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  animation: speechPulse 3s ease-in-out infinite;
}
.title-speech::after {
  content: "";
  position: absolute;
  bottom: -12px;
  left: 50%;
  transform: translateX(-50%);
  border: 8px solid transparent;
  border-top-color: var(--ts-white);
}
@keyframes speechPulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.03);
  }
}

/* Start Button */
.start-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 48px;
  font-family: var(--font-display);
  font-size: clamp(20px, 5vw, 32px);
  color: var(--ts-white);
  background: linear-gradient(135deg, var(--ts-red), var(--ts-orange));
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow:
    0 6px 20px rgba(230, 57, 70, 0.5),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}
.start-btn::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    transparent 40%,
    rgba(255, 255, 255, 0.2) 50%,
    transparent 60%
  );
  transform: translateX(-100%);
  animation: shimmer 3s ease-in-out infinite;
}
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  60% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(100%);
  }
}
.start-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 10px 30px rgba(230, 57, 70, 0.6);
}
.start-btn:active {
  transform: translateY(0) scale(0.98);
}
.btn-icon {
  font-size: 1.2em;
}

/* Title preview targets */
.title-targets {
  display: flex;
  gap: 60px;
  margin-top: 10px;
}
.title-target {
  height: clamp(50px, 12vw, 80px);
  filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
  animation: targetFloat 3s ease-in-out infinite;
}
.title-alien {
  animation-delay: 0s;
}
.title-buzz {
  animation-delay: 1.5s;
}
@keyframes targetFloat {
  0%,
  100% {
    transform: translateY(0) rotate(0deg);
  }
  25% {
    transform: translateY(-12px) rotate(5deg);
  }
  75% {
    transform: translateY(8px) rotate(-5deg);
  }
}

/* ==============================
   ROUND SCREEN
   ============================== */
#round-screen {
  z-index: 10;
  background: rgba(0, 0, 0, 0.85);
}
.round-content {
  text-align: center;
  animation: roundZoomIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes roundZoomIn {
  from {
    transform: scale(0.3);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}
.round-number {
  font-family: var(--font-display);
  font-size: clamp(48px, 12vw, 80px);
  color: var(--ts-yellow);
  text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.5);
  letter-spacing: 6px;
}
.round-theme {
  font-family: var(--font-display);
  font-size: clamp(24px, 6vw, 40px);
  color: var(--ts-white);
  margin-top: 12px;
}
.round-char-img {
  height: clamp(100px, 30vw, 200px);
  margin-top: 20px;
  filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.5));
  animation: roundCharBounce 1s ease-in-out infinite;
}
@keyframes roundCharBounce {
  0%,
  100% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(-15px) scale(1.05);
  }
}

/* ==============================
   GAME SCREEN
   ============================== */
#game-screen {
  z-index: 5;
  cursor: crosshair;
}
.game-arena {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at 50% 120%, #3d1f5c 0%, transparent 70%),
    linear-gradient(180deg, #0d1b3e 0%, #1a1050 40%, #2d1b69 70%, #4a1942 100%);
  overflow: hidden;
}
/* carnival lights decoration */
.game-arena::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: repeating-linear-gradient(
    90deg,
    var(--ts-red) 0px,
    var(--ts-red) 20px,
    var(--ts-yellow) 20px,
    var(--ts-yellow) 40px,
    var(--ts-green) 40px,
    var(--ts-green) 60px,
    var(--ts-blue) 60px,
    var(--ts-blue) 80px
  );
  animation: lightScroll 2s linear infinite;
  z-index: 2;
}
@keyframes lightScroll {
  from {
    background-position: 0 0;
  }
  to {
    background-position: 80px 0;
  }
}
.game-arena::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: repeating-linear-gradient(
    90deg,
    var(--ts-blue) 0px,
    var(--ts-blue) 20px,
    var(--ts-green) 20px,
    var(--ts-green) 40px,
    var(--ts-yellow) 40px,
    var(--ts-yellow) 60px,
    var(--ts-red) 60px,
    var(--ts-red) 80px
  );
  animation: lightScroll 2s linear infinite reverse;
  z-index: 2;
}

/* ===== TARGETS ===== */
.target {
  position: absolute;
  pointer-events: auto;
  cursor: crosshair;
  transition: none;
  will-change: transform;
}
.target img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
}
.target.hit {
  pointer-events: none;
  animation: targetHit 0.4s ease-out forwards;
}
@keyframes targetHit {
  0% {
    transform: scale(1);
    opacity: 1;
    filter: brightness(2);
  }
  50% {
    transform: scale(1.3) rotate(15deg);
    opacity: 0.8;
  }
  100% {
    transform: scale(0) rotate(30deg);
    opacity: 0;
  }
}

/* Target glow ring */
.target::before {
  content: "";
  position: absolute;
  inset: -8px;
  border-radius: 50%;
  border: 3px solid rgba(255, 209, 102, 0.4);
  animation: targetGlow 1.5s ease-in-out infinite;
}
@keyframes targetGlow {
  0%,
  100% {
    opacity: 0.4;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.05);
  }
}

/* Movement animations */
.target.move-popup {
  animation: popupMove 2s ease-in-out;
}
@keyframes popupMove {
  0% {
    transform: translateY(100px) scale(0);
    opacity: 0;
  }
  20% {
    transform: translateY(0) scale(1.2);
    opacity: 1;
  }
  30% {
    transform: translateY(0) scale(1);
  }
  80% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateY(100px) scale(0.5);
    opacity: 0;
  }
}
.target.move-slide-lr {
  animation: slideLR 3s ease-in-out;
}
@keyframes slideLR {
  0% {
    transform: translateX(-120vw);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateX(120vw);
    opacity: 0;
  }
}
.target.move-slide-rl {
  animation: slideRL 3s ease-in-out;
}
@keyframes slideRL {
  0% {
    transform: translateX(120vw);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateX(-120vw);
    opacity: 0;
  }
}
.target.move-zigzag {
  animation: zigzag 3s ease-in-out;
}
@keyframes zigzag {
  0% {
    transform: translate(-100vw, 0);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  25% {
    transform: translate(-30vw, -60px);
  }
  50% {
    transform: translate(0, 40px);
  }
  75% {
    transform: translate(30vw, -40px);
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translate(100vw, 0);
    opacity: 0;
  }
}
.target.move-float {
  animation: floatMove 4s ease-in-out;
}
@keyframes floatMove {
  0% {
    transform: translate(0, 80vh) scale(0.3);
    opacity: 0;
  }
  15% {
    opacity: 1;
  }
  50% {
    transform: translate(30px, 20vh) scale(1) rotate(10deg);
  }
  85% {
    opacity: 1;
  }
  100% {
    transform: translate(-30px, -20vh) scale(0.5) rotate(-10deg);
    opacity: 0;
  }
}
.target.move-bounce {
  animation: bounceMove 2.5s cubic-bezier(0.36, 0.07, 0.19, 0.97);
}
@keyframes bounceMove {
  0% {
    transform: translateY(-100vh);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  30% {
    transform: translateY(10px);
  }
  45% {
    transform: translateY(-50px);
  }
  60% {
    transform: translateY(5px);
  }
  75% {
    transform: translateY(-20px);
  }
  90% {
    transform: translateY(0);
    opacity: 1;
  }
  100% {
    transform: translateY(0);
    opacity: 0;
  }
}

/* ===== HUD ===== */
.game-hud {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 12px 16px;
  z-index: 20;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.5) 0%, transparent 100%);
}
.hud-left,
.hud-right {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.hud-label {
  font-family: var(--font-display);
  font-size: 11px;
  color: rgba(255, 255, 255, 0.7);
  letter-spacing: 2px;
}
.hud-value {
  font-family: var(--font-display);
  font-size: clamp(24px, 6vw, 36px);
  color: var(--ts-white);
  text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
}
.hud-score .hud-value {
  color: var(--ts-yellow);
}

/* Combo */
.hud-combo {
  display: flex;
  align-items: center;
  gap: 6px;
  animation: comboFlash 0.3s ease-out;
}
@keyframes comboFlash {
  from {
    transform: scale(1.5);
  }
  to {
    transform: scale(1);
  }
}
.combo-text {
  font-family: var(--font-display);
  font-size: clamp(20px, 5vw, 32px);
  color: var(--ts-orange);
  text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
}
.combo-label {
  font-family: var(--font-display);
  font-size: 12px;
  color: var(--ts-orange);
  letter-spacing: 2px;
}

/* Timer */
.hud-center {
  display: flex;
  align-items: center;
  justify-content: center;
}
.hud-timer-ring {
  position: relative;
  width: clamp(56px, 14vw, 80px);
  height: clamp(56px, 14vw, 80px);
}
.timer-svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}
.timer-bg-circle {
  fill: none;
  stroke: rgba(255, 255, 255, 0.15);
  stroke-width: 6;
}
.timer-fg-circle {
  fill: none;
  stroke: var(--ts-green);
  stroke-width: 6;
  stroke-linecap: round;
  stroke-dasharray: 283;
  stroke-dashoffset: 0;
  transition:
    stroke-dashoffset 1s linear,
    stroke 0.5s ease;
}
.timer-fg-circle.warning {
  stroke: var(--ts-yellow);
}
.timer-fg-circle.danger {
  stroke: var(--ts-red);
}
.timer-text {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-size: clamp(18px, 5vw, 28px);
  color: var(--ts-white);
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
}

/* ===== EFFECTS ===== */
.effects-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 15;
}

/* Score popup */
.score-popup {
  position: absolute;
  font-family: var(--font-display);
  font-size: 28px;
  color: var(--ts-yellow);
  text-shadow:
    2px 2px 0 rgba(0, 0, 0, 0.5),
    0 0 10px rgba(255, 209, 102, 0.5);
  pointer-events: none;
  animation: scoreFloat 1s ease-out forwards;
  z-index: 100;
}
@keyframes scoreFloat {
  0% {
    transform: translateY(0) scale(1.5);
    opacity: 1;
  }
  100% {
    transform: translateY(-80px) scale(1);
    opacity: 0;
  }
}

/* Star particles */
.star-particle {
  position: absolute;
  pointer-events: none;
  font-size: 16px;
  animation: starBurst 0.8s ease-out forwards;
  z-index: 100;
}
@keyframes starBurst {
  0% {
    transform: translate(0, 0) scale(1) rotate(0deg);
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

/* Miss indicator (click with no target) */
.miss-marker {
  position: absolute;
  width: 30px;
  height: 30px;
  border: 2px solid rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  pointer-events: none;
  animation: missRing 0.5s ease-out forwards;
  z-index: 100;
  transform: translate(-50%, -50%);
}
@keyframes missRing {
  0% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(2);
    opacity: 0;
  }
}

/* Crosshair flash on click */
.crosshair-flash {
  position: absolute;
  width: 40px;
  height: 40px;
  pointer-events: none;
  z-index: 100;
  transform: translate(-50%, -50%);
}
.crosshair-flash::before,
.crosshair-flash::after {
  content: "";
  position: absolute;
  background: rgba(255, 255, 255, 0.8);
}
.crosshair-flash::before {
  width: 2px;
  height: 100%;
  left: 50%;
  transform: translateX(-50%);
}
.crosshair-flash::after {
  width: 100%;
  height: 2px;
  top: 50%;
  transform: translateY(-50%);
}

/* ==============================
   RESULT SCREEN
   ============================== */
#result-screen {
  z-index: 20;
  background: linear-gradient(
    180deg,
    #1a1a5e 0%,
    #2d1b69 40%,
    #4a1942 80%,
    #e63946 100%
  );
}
.result-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  padding: 30px 20px;
  animation: resultSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes resultSlideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}
.result-header {
  text-align: center;
}
.result-title {
  font-family: var(--font-display);
  font-size: clamp(32px, 8vw, 52px);
  color: var(--ts-yellow);
  text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
}
.result-rank {
  font-size: clamp(48px, 12vw, 80px);
  margin-top: 8px;
  animation: rankPulse 2s ease-in-out infinite;
}
@keyframes rankPulse {
  0%,
  100% {
    transform: scale(1) rotate(0deg);
  }
  25% {
    transform: scale(1.1) rotate(-5deg);
  }
  75% {
    transform: scale(1.1) rotate(5deg);
  }
}

.result-characters {
  display: flex;
  gap: 30px;
}
.result-woody,
.result-jessie {
  height: clamp(80px, 20vw, 140px);
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
}
.result-woody {
  animation: charSwayL 3s ease-in-out infinite;
}
.result-jessie {
  animation: charSwayR 3s ease-in-out infinite;
}

.result-stats {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  padding: 20px 30px;
  width: min(90vw, 360px);
}
.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.stat-row:last-child {
  border-bottom: none;
}
.stat-label {
  font-family: var(--font-body);
  font-size: clamp(14px, 3.5vw, 18px);
  color: rgba(255, 255, 255, 0.8);
  font-weight: 700;
}
.stat-value {
  font-family: var(--font-display);
  font-size: clamp(20px, 5vw, 28px);
  color: var(--ts-yellow);
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
}

.result-message {
  font-family: var(--font-display);
  font-size: clamp(20px, 5vw, 32px);
  color: var(--ts-white);
  text-align: center;
  text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
}

.replay-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 40px;
  font-family: var(--font-display);
  font-size: clamp(18px, 4.5vw, 28px);
  color: var(--ts-white);
  background: linear-gradient(135deg, var(--ts-blue), var(--ts-purple));
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow:
    0 6px 20px rgba(17, 138, 178, 0.5),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}
.replay-btn::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    transparent 40%,
    rgba(255, 255, 255, 0.2) 50%,
    transparent 60%
  );
  transform: translateX(-100%);
  animation: shimmer 3s ease-in-out infinite;
}
.replay-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 10px 30px rgba(17, 138, 178, 0.6);
}
.replay-btn:active {
  transform: translateY(0) scale(0.98);
}

/* ===== Responsive ===== */
@media (max-height: 600px) {
  .title-characters {
    margin-top: 0;
  }
  .title-woody,
  .title-jessie {
    height: 80px;
  }
  .title-targets {
    display: none;
  }
  .result-characters {
    gap: 15px;
  }
  .result-woody,
  .result-jessie {
    height: 60px;
  }
}
